<% layout('./layouts/main.ejs') -%>
<div class="container">
	<div class="panel panel-info">
  	<!-- Default panel contents -->
  		<div class="panel-heading">Your resumes</div>
  		<% if (resumes.length == 0 ) {%>
  		<div class="panel-body">
		    <p>You have no resume. <a href="/createresume">Create your first resume!</a></p>
  		</div>
  		<% } else {%>
	  	<!-- Table -->
	  	<table class="table table-responsive">
	    	<thead>
	    		<tr>
	    			<th>#</th>
	    			<th>Resume title</th>
	    			<th>Privacy</th>
	    			<th>Actions</th>
	    		</tr>
	    	</thead>
	    	<tbody>
	    		<% for (var i = 0; i < resumes.length; i++) { %>
	    			<tr>
	    				<td><%= i+1 %></td>
	    				<td><%= resumes[i].title %></td>
	    				<td><% if (resumes[i].publicLink) { %>
	    					Public
	    					<button data-toggle="popover" title="Share link" class="btn btn-link btn-xs">
	    						<span class="glyphicon glyphicon-link"></span>
	    					</button>
	    					<div class="hidden">
	    						<input type="text" value="<%= resumes[i].publickLink %>"
	    					</div>
	    					<% } else { %>
	    						Private
	    					<% } %>
	    				</td>
	    				<td>
	    					<div class="btn-group btn-group-xs">
	    					<a href="/resumes/preview/<%= resumes[i].id %>" class="btn btn-default"><span class="glyphicon glyphicon-eye-open"></span> Preview</a>
	    					<a href="/resumes/<%= resumes[i].id %>?type=pdf" class="btn btn-default"><span class="glyphicon glyphicon-download-alt"></span> Download</a>
	    					<% if (resumes[i].publicLink) { %>
	    					<button data-id="<%= resumes[i].id %>" class="btn btn-default prv-res">
	    						<span class="glyphicon glyphicon-lock"></span> Private
	    					</button>
	    					<% } else{ %> 
	    					<button data-id="<%= resumes[i].id %>" class="btn btn-default pub-res">
	    						<span class="glyphicon glyphicon-globe"></span>Public
	    					</button>
	    					<% }; %>
	    					
	    					<a href="/resumes/<%= resumes[i].id %>/edit" class="btn btn-primary"><span class="glyphicon glyphicon-pencil"></span> Edit</a>
	    					<button data-id="<%= resumes[i].id %>" class="btn btn-danger del-res">
	    						<span class="glyphicon glyphicon-remove"></span>Delete
	    					</button>

	    					</div>
	    				</td>
	    			</tr>
	    		<% }; %>
	    	</tbody>
	  	</table>
	  	<% } %>
	</div>
</div>
<script type="text/javascript">
$(function () {
	$('.del-res').click(function () {
		var self = $(this).parents('tr');
		$.ajax({
			url: "/resumes/"+ $(this).data('id'),
			method: "DELETE",
			success: function () {
				self.fadeOut(300, function () {
					self.remove();
				});
			}
		});
	});
	$('[data-toggle=popover]').each(function () {
		var self = $(this);
		self.popover({
			content: function () {
				return $('pop-content-'+self.data('id')).html();
			},
			html: true
		})
	});
	$('body').on('click', function (e) {
        //did not click a popover toggle, or icon in popover toggle, or popover
        if ($(e.target).data('toggle') !== 'popover'
            && $(e.target).parents('[data-toggle="popover"]').length === 0
            && $(e.target).parents('.popover.in').length === 0) { 
            $('[data-toggle="popover"]').popover('hide');
        }
    });
});

</script>